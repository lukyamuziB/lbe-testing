machine:
  pre:
    - sudo apt-get update; USE_PRECOMPILE=true sudo -E circleci-install php 7.1.4
  php:
    version: 7.1.4
  environment:
    APP_ENV: testing
    POSTGRES_USER: ubuntu
    POSTGRES_HOST: "127.0.0.1"
    POSTGRES_DB: lenken-test
    CIRCLE_PROJECT_USERNAME: andela
    CIRCLE_PROJECT_REPONAME: lenken-server
    IMG_TAG: $(echo $CIRCLE_SHA1 | cut -c -7)
  services:
    - redis

general:
  artifacts:
    - "reports"

dependencies:
  override:
    - curl -sS https://getcomposer.org/installer | php --filename=composer
    - composer install --prefer-dist --no-interaction

test:
  override:
    - composer test
  post:
    - CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN vendor/bin/test-reporter

#deployment:
#  staging:
#    branch: develop
#    heroku:
#      appname: lenken-api-staging
